import{r as c,j as e,af as K,aa as f,v as d,X as $,q as w,aA as z,Q as F,z as W,b1 as y,aJ as X,b2 as G,b3 as Z}from"./vendor-react-NdMTiU_3.js";import{u as ee,A as se,B as r,C as k,a as C,b as q,d as A,f as j,I as ae}from"./dashboard-BRRSZ3Kr.js";import"./vendor-inertia-Uge9r9zn.js";import"./vendor-other-DeegM5Eu.js";import"./vendor-charts-wdNP6emn.js";const te=[{title:"Dashboard",href:"/dashboard"},{title:"Cart",href:"/cart"}];function me({cartItems:re,total:le,flash:x}){const{cart:O,updateCartItem:Q,removeFromCart:B,clearCart:D,getCartTotal:L}=ee(),[S,_]=c.useState(!1),[m,u]=c.useState(!1),[M,N]=c.useState(null),[n,b]=c.useState(0),[T,E]=c.useState(0),[V,R]=c.useState(null),[Y,I]=c.useState(null);c.useEffect(()=>()=>{window.checkoutRedirectTimeout&&clearTimeout(window.checkoutRedirectTimeout)},[]);const o=Object.values(O).map(s=>({product_id:s.product_id,product_name:s.product_name,quantity:s.quantity,unit_price:s.unit_price,total_price:s.quantity*s.unit_price})),P=L(),H=s=>{N(s.product_id),b(s.quantity),E(s.unit_price)},U=async s=>{R(s);try{Q(s,n),await d.put(`/cart/items/${s}`,{quantity:n,unit_price:T}),N(null)}catch(t){console.error("Error updating cart item:",t)}finally{R(null)}},J=async s=>{if(confirm("Are you sure you want to remove this item from cart?")){I(s);try{B(s),await d.delete(`/cart/items/${s}`)}catch(t){console.error("Error removing cart item:",t)}finally{I(null)}}},h=async(s=0)=>{if(o.length===0){alert("Your cart is empty.");return}_(!0);const t=2;try{const a=o.map(i=>({product_id:i.product_id,quantity:i.quantity,unit_price:i.unit_price}));console.log("Starting checkout process...",{cartItems:a}),console.log("Step 1: Syncing cart data..."),await d.post("/cart/sync",{cart:a}),console.log("‚úÖ Cart synced successfully"),console.log("Step 2: Processing checkout..."),await new Promise((i,p)=>{const v=setTimeout(()=>{p(new Error("Checkout timeout - the process is taking too long"))},15e3);d.post("/cart/checkout",{},{onSuccess:g=>{clearTimeout(v),console.log("‚úÖ Checkout completed successfully"),i(g)},onError:g=>{clearTimeout(v),console.error("‚ùå Checkout failed:",g),p(new Error(g.message||"Checkout failed"))},onFinish:()=>{clearTimeout(v)}})}),console.log("‚úÖ Checkout process completed, showing success screen"),u(!0),D();const l=setTimeout(()=>{console.warn("‚ö†Ô∏è Redirect timeout - manually redirecting to sales page"),u(!1),d.get("/sales")},8e3);window.checkoutRedirectTimeout=l}catch(a){if(console.error("‚ùå Checkout failed:",a),a.response?.status===422){const l=a.response.data?.message||"Validation error occurred";alert(`Validation Error: ${l}`)}else if(a.response?.status===500)if(s<t){console.log(`üîÑ Retrying checkout (attempt ${s+1}/${t+1})...`),setTimeout(()=>{h(s+1)},1e3*(s+1));return}else alert("Server Error: Multiple attempts failed. Please try again later or contact support.");else if(a.response?.status===403)alert("Access Denied: You are not authorized to complete this sale.");else if(a.message?.includes("verification"))if(s<t){console.log(`üîÑ Retrying verification (attempt ${s+1}/${t+1})...`),setTimeout(()=>{h(s+1)},1e3*(s+1));return}else alert(`Sale Verification Failed: ${a.message}`);else if(s<t&&(!a.response||a.code==="NETWORK_ERROR")){console.log(`üîÑ Retrying due to network error (attempt ${s+1}/${t+1})...`),setTimeout(()=>{h(s+1)},1e3*(s+1));return}else alert("Checkout Failed: Please try again. If the problem persists, contact support.");console.log("‚ùå Cart preserved due to error")}finally{_(!1)}};return e.jsxs(se,{breadcrumbs:te,children:[e.jsx(K,{title:"Shopping Cart"}),m&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"relative bg-white dark:bg-gray-900 rounded-2xl p-8 shadow-2xl transform transition-all duration-500 scale-100 animate-in fade-in-0 zoom-in-95",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center animate-pulse",children:e.jsx(f,{className:"w-10 h-10 text-green-600 dark:text-green-400 animate-bounce"})}),e.jsx("div",{className:"absolute inset-0 w-20 h-20 bg-green-200 dark:bg-green-800/40 rounded-full animate-ping"})]})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Sale Completed!"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Redirecting to your receipt..."}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"If you're not redirected automatically, click below"})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden mb-6",children:e.jsx("div",{className:"h-full bg-green-500 rounded-full animate-pulse transition-all duration-1000 ease-out"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsx(r,{onClick:()=>{u(!1),d.get("/sales")},className:"bg-green-600 hover:bg-green-700 text-white",children:"View Sales"}),e.jsx(r,{onClick:()=>{u(!1),d.get("/cart")},variant:"outline",className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:"Continue Shopping"})]})]})}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 rounded-xl p-4 md:p-6 pb-20 sm:pb-6",children:[x?.success&&e.jsx("div",{className:"rounded-lg border border-green-200 bg-green-50 p-4 text-green-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(f,{className:"mt-0.5 h-5 w-5 flex-shrink-0 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Success!"}),e.jsx("p",{className:"text-sm",children:x.success})]})]})}),x?.error&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4 text-red-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{className:"mt-0.5 h-5 w-5 flex-shrink-0 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Error!"}),e.jsx("p",{className:"text-sm",children:x.error})]})]})}),e.jsxs("div",{className:"flex flex-col justify-between gap-4 md:flex-row md:items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight md:text-3xl",children:"Shopping Cart"}),e.jsx("p",{className:"mt-1 text-muted-foreground",children:"Review and checkout your items"})]}),e.jsxs(w,{href:"/dashboard",children:[e.jsxs(r,{variant:"outline",className:"hidden md:inline-flex",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]}),e.jsx(r,{variant:"outline",size:"icon",className:"md:hidden",children:e.jsx(z,{className:"h-4 w-4"})})]})]}),o.length===0?e.jsx(k,{className:"border-0 shadow-none",children:e.jsxs(C,{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-6 flex h-16 w-16 items-center justify-center rounded-full bg-blue-50",children:e.jsx(F,{className:"h-8 w-8 text-blue-600"})}),e.jsx("h3",{className:"mb-3 text-xl font-semibold",children:"Your cart is empty"}),e.jsx("p",{className:"mx-auto mb-6 max-w-md text-muted-foreground",children:"Add some products to your cart to get started."}),e.jsx(w,{href:"/dashboard",children:e.jsxs(r,{className:"bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800",children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Browse Products"]})})]})}):e.jsx("div",{className:`transition-all duration-500 ${m?"opacity-50 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"space-y-4 lg:col-span-2 order-last lg:order-first",children:e.jsxs(k,{className:"border-0 shadow-sm",children:[e.jsx(q,{className:"px-4 py-4 md:px-6",children:e.jsxs(A,{className:"text-lg",children:["Cart Items ",e.jsxs("span",{className:"text-muted-foreground",children:["(",o.length,")"]})]})}),e.jsx(C,{className:"px-0 pb-0",children:e.jsx("div",{className:"divide-y",children:o.map(s=>{const t=M===s.product_id,a=V===s.product_id,l=Y===s.product_id,i=999;return e.jsx("div",{className:`relative px-4 py-5 transition-all duration-300 md:px-6 ${l?"opacity-50":""}`,children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-md bg-muted",children:e.jsx(F,{className:"h-8 w-8 text-muted-foreground"})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex flex-col gap-1 md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"truncate font-medium",children:s.product_name}),e.jsx("p",{className:"truncate text-sm text-muted-foreground",children:"Product"})]}),e.jsx("div",{className:"mt-1 text-lg font-semibold md:mt-0",children:j(s.total_price)})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Qty:"}),t?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(r,{type:"button",variant:"outline",size:"sm",onClick:()=>b(Math.max(1,n-1)),disabled:n<=1,className:"h-8 w-8 p-0 flex-shrink-0",children:e.jsx("span",{className:"text-sm font-bold",children:"-"})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsx("span",{className:"text-sm font-medium px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded-md min-w-[40px] inline-block",children:n})}),e.jsx(r,{type:"button",variant:"outline",size:"sm",onClick:()=>b(Math.min(i,n+1)),disabled:n>=i,className:"h-8 w-8 p-0 flex-shrink-0",children:e.jsx("span",{className:"text-sm font-bold",children:"+"})})]}):e.jsx("span",{className:"font-medium",children:s.quantity})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Price:"}),t?e.jsx(ae,{type:"number",step:"0.01",min:"0",value:T,onChange:p=>E(parseFloat(p.target.value)||0),className:"h-10 w-28 sm:h-8 sm:w-24",disabled:a}):e.jsx("span",{className:"font-medium",children:j(s.unit_price)})]}),e.jsx("div",{className:"ml-auto flex items-center gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx(r,{size:"sm",onClick:()=>U(s.product_id),disabled:a,className:"h-10 w-10 sm:h-8 sm:w-8 p-0",children:a?e.jsx(y,{className:"h-4 w-4 animate-spin"}):e.jsx(f,{className:"h-4 w-4"})}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>N(null),disabled:a,className:"h-10 w-10 sm:h-8 sm:w-8 p-0",children:e.jsx($,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>H(s),disabled:l,className:"h-10 w-10 sm:h-8 sm:w-8 p-0 text-blue-600 hover:bg-blue-50",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>J(s.product_id),disabled:l,className:"h-10 w-10 sm:h-8 sm:w-8 p-0 text-red-600 hover:bg-red-50",children:l?e.jsx(y,{className:"h-4 w-4 animate-spin"}):e.jsx(G,{className:"h-4 w-4"})})]})})]})]})]})},s.product_id)})})})]})}),e.jsx("div",{className:`order-first lg:order-last transition-all duration-500 ${m?"opacity-50 scale-95":"opacity-100 scale-100"}`,children:e.jsxs(k,{className:"border-0 shadow-sm lg:sticky lg:top-6",children:[e.jsx(q,{className:"px-4 py-4 md:px-6",children:e.jsx(A,{className:"text-lg",children:"Order Summary"})}),e.jsxs(C,{className:"px-4 md:px-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsx("span",{className:"font-medium",children:j(P)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Tax"}),e.jsx("span",{className:"font-medium",children:"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping"}),e.jsx("span",{className:"font-medium",children:"-"})]}),e.jsx("div",{className:"mt-2 border-t pt-4",children:e.jsxs("div",{className:"flex justify-between text-base font-semibold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:j(P)})]})})]}),e.jsx(r,{size:"lg",onClick:()=>h(),disabled:S||m||o.length===0,className:"mt-6 w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 disabled:opacity-50 disabled:cursor-not-allowed",children:S?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):m?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"mr-2 h-4 w-4"}),"Sale Completed!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Complete Sale"]})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx(w,{href:"/dashboard",className:"text-sm text-blue-600 hover:underline",children:"Continue Shopping"})})]})]})})]})})]})]})}export{me as default};
