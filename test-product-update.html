<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Update Test</title>
</head>
<body>
    <h1>Product Update Form Test</h1>
    
    <form id="testForm">
        <div>
            <label for="name">Name:</label>
            <input type="text" id="name" name="name" value="Test Product">
        </div>
        <div>
            <label for="category">Category:</label>
            <input type="text" id="category" name="category" value="Test Category">
        </div>
        <div>
            <label for="quantity">Quantity:</label>
            <input type="number" id="quantity" name="quantity" value="10">
        </div>
        <div>
            <label for="cost_price">Cost Price:</label>
            <input type="number" id="cost_price" name="cost_price" value="100">
        </div>
        <div>
            <label for="selling_price">Selling Price:</label>
            <input type="number" id="selling_price" name="selling_price" value="150">
        </div>
        <div>
            <label for="low_stock_threshold">Low Stock Threshold:</label>
            <input type="number" id="low_stock_threshold" name="low_stock_threshold" value="5">
        </div>
        <button type="submit">Test Submit</button>
    </form>

    <div id="output"></div>

    <script>
        // Simulate the form data processing logic from our React component
        const formData = {
            name: 'Test Product',
            category: 'Test Category',
            description: 'Test Description',
            brand: 'Test Brand',
            image_url: 'http://example.com/image.jpg',
            features: ['Feature 1', 'Feature 2'],
            sku: 'TEST-SKU-001',
            quantity: 10,
            cost_price: 100,
            selling_price: 150,
            discount_price: null,
            low_stock_threshold: 5,
            is_active: true,
            imageFile: null
        };

        console.log('Original form data:', formData);

        // Test the form data processing logic
        function testFormDataProcessing() {
            const formDataToSend = new FormData();
            
            console.log('=== TESTING FORM DATA PROCESSING ===');
            console.log('Form data keys:', Object.keys(formData));
            console.log('Form data values:', Object.values(formData));
            
            // Add all form fields EXCEPT image_url (we'll handle it separately)
            Object.keys(formData).forEach(key => {
                if (key === 'features') {
                    // Send features as proper JSON array
                    const features = formData.features || [];
                    formDataToSend.append(key, JSON.stringify(features));
                    console.log(`Added features:`, features);
                } else if (key === 'imageFile') {
                    // Handle file upload - only send if there's an actual file
                    if (formData.imageFile) {
                        formDataToSend.append('image', formData.imageFile);
                        console.log('Added image file:', formData.imageFile.name);
                    }
                } else if (key === 'image_url') {
                    // Skip image_url here - we'll handle it separately
                    console.log('Skipping image_url in main loop');
                } else if (key !== 'imageFile') {
                    // Handle other fields - send ALL values, including empty strings and 0
                    const value = formData[key];
                    if (value !== undefined && value !== null) {
                        if (typeof value === 'boolean') {
                            formDataToSend.append(key, value ? '1' : '0');
                        } else {
                            // Send the value as is, even if it's an empty string or 0
                            formDataToSend.append(key, String(value));
                        }
                        console.log(`Added field ${key}:`, value);
                    } else {
                        console.log(`Skipping field ${key}: undefined or null`);
                    }
                }
            });

            // Handle image_url separately - only add if no file is uploaded AND it's a real URL
            if (!formData.imageFile && formData.image_url && !formData.image_url.startsWith('blob:')) {
                formDataToSend.append('image_url', formData.image_url);
                console.log('Added image_url:', formData.image_url);
            } else if (formData.imageFile) {
                console.log('Skipping image_url because we have imageFile');
            } else if (formData.image_url?.startsWith('blob:')) {
                console.log('Skipping blob URL:', formData.image_url);
            } else {
                console.log('No image_url to add - field is empty or null');
            }

            // Debug: Log what we're sending
            console.log('Final form data being sent:', Object.fromEntries(formDataToSend.entries()));
            
            return formDataToSend;
        }

        // Test the form submission
        document.getElementById('testForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const result = testFormDataProcessing();
            
            // Display results
            const output = document.getElementById('output');
            output.innerHTML = `
                <h3>Test Results:</h3>
                <p>Form data entries: ${result.entries().length}</p>
                <pre>${JSON.stringify(Object.fromEntries(result.entries()), null, 2)}</pre>
            `;
        });

        // Run test immediately
        console.log('Running initial test...');
        testFormDataProcessing();
    </script>
</body>
</html>
